<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>OCR Reader</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  background:#0d1117;
  color:white;
  font-family:Arial;
  margin:0;
  padding:0;
}

.container {
  padding:15px;
  max-width:600px;
  margin:auto;
}

#drop {
  border:2px dashed #888;
  padding:40px;
  text-align:center;
  border-radius:10px;
  margin-bottom:10px;
}

#orig {
  width:100%;
  max-width:100%;
  display:none;
  margin-bottom:15px;
  border-radius:10px;
}

#output {
  background:#111;
  padding:15px;
  white-space:pre-wrap;
  border-radius:10px;
  margin-top:15px;
  font-size:15px;
}

#log {
  margin-top:10px;
  font-size:14px;
  color:#9f9;
}

.progress {
  width:100%;
  height:10px;
  background:#333;
  border-radius:5px;
  margin-top:10px;
  overflow:hidden;
}
.bar {
  width:0%;
  height:10px;
  background:#4caf50;
}
</style>
</head>

<body>
<div class="container">

  <h2>Image OCR (English)</h2>

  <div id="drop">
    Drop or Click
    <br>(mobile & desktop)
    <input id="fileInput" type="file" accept="image/*" style="display:none;">
  </div>

  <img id="orig">

  <div class="progress"><div class="bar" id="bar"></div></div>
  <div id="log"></div>

  <div id="output">Waiting for image...</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<script>
const drop = document.getElementById("drop");
const fileInput = document.getElementById("fileInput");
const orig = document.getElementById("orig");
const output = document.getElementById("output");
const logDiv = document.getElementById("log");
const bar = document.getElementById("bar");

drop.addEventListener("click",()=>fileInput.click());
drop.addEventListener("dragover",e=>e.preventDefault());
drop.addEventListener("drop", e=>{
  e.preventDefault();
  handle(e.dataTransfer.files[0]);
});

fileInput.addEventListener("change", e=>{
  handle(e.target.files[0]);
});

async function handle(file){
  const url = URL.createObjectURL(file);
  orig.src = url;
  orig.style.display="block";
  output.textContent="Processing...";
  logDiv.textContent="";

  await runOCR(url);
}

async function preprocess(img){
  const maxSize=1500;

  let scale=Math.min(
    maxSize/img.width,
    maxSize/img.height,
    1
  );

  const cvs=document.createElement("canvas");
  const ctx=cvs.getContext("2d");

  cvs.width=img.width*scale;
  cvs.height=img.height*scale;
  ctx.drawImage(img,0,0,cvs.width,cvs.height);

  let data=ctx.getImageData(0,0,cvs.width,cvs.height);
  let px=data.data;

  for(let i=0;i<px.length;i+=4){
    let avg=(px[i]+px[i+1]+px[i+2])/3;
    avg=Math.min(255,avg*1.3);
    px[i]=px[i+1]=px[i+2]=avg;
  }

  ctx.putImageData(data,0,0);
  return cvs;
}

async function runOCR(url){
  logDiv.textContent="Loading image...";
  const img=new Image();
  img.src=url;

  await img.decode();
  const processed=await preprocess(img);

  logDiv.textContent="Running OCR...";

  const worker=await Tesseract.createWorker({
    logger:m=>{
      if(m.status==="recognizing text"){
        bar.style.width=Math.round(m.progress*100)+"%";
        logDiv.textContent=Math.round(m.progress*100)+"% completed";
      }
    }
  });

  await worker.loadLanguage('eng');
  await worker.initialize('eng');

  const {data}=await worker.recognize(processed);

  await worker.terminate();

  output.textContent=data.text.trim();
  logDiv.textContent="Done âœ“";
}
</script>
</body>
</html>
