<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>OCR + Transliteration + Translation</title>

<script src="https://unpkg.com/tesseract.js@2.1.5/dist/tesseract.min.js"></script>

<style>
    body {
        margin:0;
        padding:0;
        background:#0e0f15;
        color:white;
        font-family: 'Inter', sans-serif;
        text-align:center;
    }

    .container {
        max-width:500px;
        margin:0 auto;
        padding:15px;
    }

    #dropzone {
        border:2px dashed #555;
        border-radius:12px;
        padding:20px;
        font-size:18px;
        margin-top:15px;
        transition:0.3s;
        width:100%;
    }

    #dropzone.dragover {
        border-color:#ff00ee;
        background:#1a1a28;
    }

    img {
        width:100%;
        border-radius:12px;
        margin-top:15px;
    }

    .output-box {
        background:#11141e;
        padding:15px;
        margin-top:15px;
        border-radius:12px;
        text-align:left;
        font-size:16px;
        white-space:pre-line;
        overflow-x:auto;
    }

    .log {
        margin-top:15px;
        background:#00000050;
        padding:10px;
        border-radius:8px;
        font-size:14px;
        color:#ddd;
        white-space:pre-line;
        text-align:left;
    }

    @media(max-width:480px) {
        body { font-size: 16px; }
    }

</style>
</head>

<body>

<div class="container">

    <!-- DRAG & DROP COMES FIRST -->
    <div id="dropzone">Drop / Click to upload</div>
    <input id="fileInput" type="file" accept="image/*" style="display:none">

    <!-- ORIGINAL IMAGE -->
    <img id="preview" style="display:none;">

    <!-- OCR -->
    <div class="output-box" id="ocrText"></div>

    <!-- TRANSLIT -->
    <div class="output-box" id="translit"></div>

    <!-- TRANSLATION -->
    <div class="output-box" id="translated"></div>

    <div class="log" id="log"></div>

</div>

<script>
// ------------------------------------------------
// UTILS
// ------------------------------------------------
function log(msg){
    document.getElementById("log").innerText += msg + "\n";
}

// ------------------------------------------------
// FILE PICK SETUP
// ------------------------------------------------
const dropzone = document.getElementById("dropzone");
const fileInput = document.getElementById("fileInput");

dropzone.onclick = ()=>{
    fileInput.click();
};

fileInput.onchange = (e)=>{
    const file = e.target.files[0];
    if(file) handleFile(file);
};

dropzone.ondragover = (e)=>{
    e.preventDefault();
    dropzone.classList.add("dragover");
};

dropzone.ondragleave = ()=>{
    dropzone.classList.remove("dragover");
};

dropzone.ondrop = (e)=>{
    e.preventDefault();
    dropzone.classList.remove("dragover");
    const file = e.dataTransfer.files[0];
    if(file) handleFile(file);
};

// ------------------------------------------------
// MAIN PROCESS
// ------------------------------------------------
function handleFile(file){
    log("File received");
    preview.src = URL.createObjectURL(file);
    preview.style.display="block";
    runOCR(file);
}

// ------------------------------------------------
// OCR
// ------------------------------------------------
function runOCR(file){
    log("Starting OCR...");
    Tesseract.recognize(file,'eng',{ logger:m=>{} }).then(({data})=>{

        if(!data.text || data.text.trim()===""){
            document.getElementById("ocrText").innerText="No text extracted";
            return;
        }

        document.getElementById("ocrText").innerText=data.text;
        log("OCR completed");

        runTransliteration(data.text);
    });
}

// ------------------------------------------------
// SIMPLE TRANSLITERATION (demo rule based)
// ------------------------------------------------
function runTransliteration(text){
    log("Running transliteration...");

    // This keeps same behavior as before.
    // You can extend later rule based mapping here.

    const output = text;
    document.getElementById("translit").innerText = output;

    runTranslation(text);
}

// ------------------------------------------------
// SIMPLE TRANSLATION API (free CDN)
// ------------------------------------------------
function runTranslation(text){
    log("Running translation...");

    fetch("https://api.mymemory.translated.net/get?q="
        + encodeURIComponent(text) + "&langpair=kn|en")
    .then(r=>r.json())
    .then(res=>{
        document.getElementById("translated").innerText =
            res.responseData.translatedText;
        log("Translation completed");
    })
}
</script>

</body>
</html>
