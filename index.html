<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kannada → English Image Translator</title>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
<script src="https://unpkg.com/aksharamukha-js/dist/aksharamukha.js"></script>

<style>
    body {
        font-family: sans-serif;
        background: radial-gradient(circle at top, #111, #000);
        color: white;
        text-align: center;
        padding: 30px;
    }
    .container {
        margin-top: 20px;
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        gap: 25px;
    }
    canvas {
        border: 2px solid #444;
        border-radius: 10px;
        max-width: 360px;
    }
    #uploadBox {
        border: 2px dashed #888;
        width: 110px;
        height: 110px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        border-radius: 10px;
    }
    .btn {
        margin-top: 8px;
        padding: 10px 20px;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        background: #ff0077;
        color: white;
        font-size: 14px;
    }
    #credit {
        margin-top: 50px;
        font-family: cursive;
        font-size: 22px;
        background: linear-gradient(90deg, #ff4c4c, #ffaa00, #00ffee, #ff4c4c);
        -webkit-background-clip: text;
        color: transparent;
        animation: glow 2s linear infinite;
    }
    @keyframes glow {
        0% { filter: brightness(0.7); }
        50% { filter: brightness(1.7); }
        100% { filter: brightness(0.7); }
    }
</style>
</head>

<body>

<h2> Kannada → English OCR + Transliteration + Meaning</h2>
<label id="uploadBox">
    <input type="file" id="file" hidden accept="image/*">
    Upload
</label>

<div id="status"></div>

<div class="container">
    <div>
        <canvas id="orig"></canvas>
        <p>Original</p>
    </div>
    <div>
        <canvas id="translit"></canvas>
        <p>Transliteration</p>
        <button class="btn" onclick="downloadCanvas('translit')">Download</button>
    </div>
    <div>
        <canvas id="translated"></canvas>
        <p>Translation</p>
        <button class="btn" onclick="downloadCanvas('translated')">Download</button>
    </div>
</div>

<div id="credit">Created by Animesh</div>

<script>
const fileInput = document.getElementById("file");
fileInput.addEventListener("change", startProcessing);

function downloadCanvas(id) {
    const link = document.createElement("a");
    link.download = id + ".png";
    link.href = document.getElementById(id).toDataURL();
    link.click();
}

async function startProcessing(e) {
    const file = e.target.files[0];
    if(!file) return;

    document.getElementById("status").innerText = "Reading image...";

    const img = new Image();
    img.src = URL.createObjectURL(file);
    await img.decode();

    drawOnCanvas("orig", img);

    document.getElementById("status").innerText = "Extracting Kannada text...";
    const result = await Tesseract.recognize(img, "kan", {});

    const kannadaText = result.data.text.trim();
    console.log("OCR:", kannadaText);

    if(!kannadaText){
        document.getElementById("status").innerText = "No Kannada detected!";
        return;
    }

    document.getElementById("status").innerText = "Transliterating...";
    const EnglishTranslit = await Aksharamukha.convert("Kannada","Latin", kannadaText);

    // Render transliteration image
    drawTextCanvas("translit", img, EnglishTranslit);

    document.getElementById("status").innerText = "Translating...";
    const translated = await translateFree(EnglishTranslit);

    // Render translation image
    drawTextCanvas("translated", img, translated);

    document.getElementById("status").innerText = "Done ✔";
}

async function translateFree(txt){
    try{
        const res = await fetch("https://libretranslate.de/translate", {
            method: "POST",
            headers: { "content-type": "application/json" },
            body: JSON.stringify({q: txt, source:"auto", target:"en"})
        });
        const data = await res.json();
        return data.translatedText;
    }catch{
        return "(Translation API error)";
    }
}

function drawOnCanvas(id, img){
    const c = document.getElementById(id);
    const ctx = c.getContext("2d");
    c.width = img.width;
    c.height = img.height;
    ctx.drawImage(img, 0, 0);
}

function drawTextCanvas(id, img, text){
    const c = document.getElementById(id);
    const ctx = c.getContext("2d");

    c.width = img.width;
    c.height = img.height;

    ctx.drawImage(img, 0, 0);

    ctx.fillStyle = "rgba(0,0,0,0.5)";
    ctx.fillRect(0, c.height-120, c.width, 120);

    ctx.fillStyle = "#fff";
    ctx.font = "32px Arial";
    wrapText(ctx, text, 20, c.height-80, c.width-40, 32);
}

function wrapText(ctx, text, x, y, maxWidth, lineHeight){
    const words = text.split(' ');
    let line = '';
    for (let n=0;n<words.length;n++){
        let test = line+words[n]+' ';
        let width = ctx.measureText(test).width;
        if(width>maxWidth){ ctx.fillText(line,x,y); line=words[n]+' '; y+=lineHeight; }
        else line=test;
    }
    ctx.fillText(line,x,y);
}
</script>

</body>
</html>
