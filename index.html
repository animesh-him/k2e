<!DOCTYPE html>
<html>
<head>
  <title>Kannada + English OCR + Translation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body { font-family: Arial; margin: 10px; max-width: 600px; }
    textarea { width: 100%; height: 120px; font-size: 16px; }
    button { padding: 10px; width: 100%; margin-top: 10px; }
  </style>
</head>
<body>

<h2>Kannada + English OCR + Translation</h2>

<input type="file" id="imgInput" accept="image/*">
<button onclick="process()">Convert</button>

<div id="progress"></div>

<h3>OCR Output</h3>
<textarea id="ocrText"></textarea>
<button onclick="download('ocrText','ocr.txt')">Download OCR</button>

<h3>English Translation</h3>
<textarea id="englishText"></textarea>
<button onclick="download('englishText','english.txt')">Download Translation</button>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<script>
async function runOCR(img) {

  const kan = await Tesseract.recognize(img, 'kan');
  const eng = await Tesseract.recognize(img, 'eng');

  const text = kan.data.text.trim() + "\n" + eng.data.text.trim();
  return text.trim();
}

async function translate(text){

  let endpoints = [
    txt => `https://api.mymemory.translated.net/get?q=${encodeURIComponent(txt)}&langpair=kn|en`,
    txt => `https://translate.astian.org/translate`,
    txt => `https://libretranslate.de/translate`,
    txt => `https://translate.argosopentech.com/translate`
  ];

  for (let buildURL of endpoints) {
    try {
      let url = buildURL(text);
      let res;

      if(url.includes("mymemory")){
        res = await fetch(url);
        let j = await res.json();
        return j.responseData.translatedText;
      }

      res = await fetch(url, {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({
          q:text, source:"kn", target:"en", format:"text"
        })
      });

      let j = await res.json();
      if(j.translatedText) return j.translatedText;

    } catch(e){ continue; }
  }

  return "Translation failed (all services busy)";
}

async function process() {

  const file = document.getElementById("imgInput").files[0];
  if(!file){ alert("Choose image first"); return; }

  document.getElementById("progress").innerText="Processing...";

  let reader = new FileReader();
  reader.readAsDataURL(file);

  reader.onload = async () => {

    let text = await runOCR(reader.result);

    document.getElementById("ocrText").value = text;

    let english = await translate(text);

    document.getElementById("englishText").value = english;

    document.getElementById("progress").innerText="Done!";
  };
}

function download(id, filename){
  const text = document.getElementById(id).value;
  const blob = new Blob([text]);
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  a.click();
}
</script>

</body>
</html>
