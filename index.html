<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Kannada OCR + Transliteration + Translation</title>
<style>
    body {
        background:#111;
        color:white;
        font-family:Arial;
        padding:15px;
    }
    textarea {
        width:100%;
        height:140px;
        font-size:18px;
        padding:10px;
        background:#000;
        color:white;
    }
    .box {
        border:2px dashed #6a6;
        padding:20px;
        text-align:center;
        margin-bottom:20px;
        cursor:pointer;
    }
    button {
        background:linear-gradient(90deg,#ff2,#f0f,#90f);
        border:none;
        padding:15px;
        width:100%;
        color:black;
        font-weight:bold;
        font-size:18px;
        margin:15px 0;
    }
</style>
</head>
<body>

<h2>Upload Image</h2>
<div class="box" id="dropArea">Drop a picture or click here</div>
<input type="file" id="fileInput" hidden />

<h2>OCR Output</h2>
<textarea id="ocrText">Waiting for image...</textarea>

<button onclick="download('ocrText','ocr.txt')">Download OCR</button>

<h2>Transliteration (Kannada â†’ Latin)</h2>
<textarea id="latinText"></textarea>
<button onclick="download('latinText','latin.txt')">Download Transliteration</button>

<h2>English Translation</h2>
<textarea id="englishText"></textarea>
<button onclick="download('englishText','translation.txt')">Download Translation</button>


<!-- Tesseract -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<!-- Transliteration Library -->
<script src="https://cdn.jsdelivr.net/npm/sanscript@1.0.1/sanscript.min.js"></script>

<script>
let drop = document.getElementById("dropArea");
let fileInput = document.getElementById("fileInput");

drop.onclick = ()=> fileInput.click();

drop.addEventListener("dragover",(e)=>{e.preventDefault();});
drop.addEventListener("drop",(e)=>{
    e.preventDefault();
    process(e.dataTransfer.files[0]);
});
fileInput.addEventListener("change",(e)=>{
    process(e.target.files[0]);
});


async function process(file){
    document.getElementById("ocrText").value = "Processing OCR...";
    document.getElementById("latinText").value = "";
    document.getElementById("englishText").value = "";

    const worker = await Tesseract.createWorker();
    await worker.loadLanguage('kan+eng');
    await worker.initialize('kan+eng');

    const { data:{ text } } = await worker.recognize(file);
    await worker.terminate();

    document.getElementById("ocrText").value = text;

    transliterate(text);
    translate(text);
}

function transliterate(text){
    try {
        const out = Sanscript.t(text,"kannada","iast");
        document.getElementById("latinText").value = out;
    } catch(e){
        document.getElementById("latinText").value = "Transliteration failed.";
    }
}

async function translate(txt){
    try {
        const url =
        "https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=en&dt=t&q="+
        encodeURIComponent(txt);

        const res = await fetch(url);
        const data = await res.json();
        document.getElementById("englishText").value = data[0].map(x=>x[0]).join("");
    } catch(e){
        document.getElementById("englishText").value = "Translation failed.";
    }
}

function download(id, name){
    const el = document.getElementById(id).value;
    const a = document.createElement("a");
    a.href="data:text/plain;charset=utf-8,"+encodeURIComponent(el);
    a.download = name;
    a.click();
}
</script>

</body>
</html>
