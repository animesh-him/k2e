<!DOCTYPE html>
<html>
<head>
<title>Kannada. OCR + Transliterate + Translate</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;margin:10px;max-width:600px}
textarea{width:100%;height:120px;font-size:16px;margin-top:10px}
button{padding:10px;width:100%;margin-top:10px}
.credits{font-family:cursive;text-align:center;margin-top:25px;opacity:.7}
</style>
</head>
<body>

<h2>Kannada. OCR + Transliteration + Translation</h2>

<input type="file" id="imgInput" accept="image/*">
<button onclick="process()">Convert</button>

<div id="progress"></div>

<h3>OCR Result</h3>
<textarea id="ocr"></textarea>
<button onclick="download('ocr','ocr.txt')">Download OCR</button>

<h3>Transliteration (Latin script)</h3>
<textarea id="lat"></textarea>
<button onclick="download('lat','translit.txt')">Download Transliteration</button>

<h3>English Translation</h3>
<textarea id="eng"></textarea>
<button onclick="download('eng','english.txt')">Download Translation</button>

<div class="credits">Created by Animesh</div>

<!-- OCR script -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<!-- WORKING TRANSLITERATOR -->
<script src="https://cdn.jsdelivr.net/npm/transliteration/dist/browser/bundle.umd.min.js"></script>

<script>
async function process(){
  const file=document.getElementById("imgInput").files[0];
  if(!file){alert("Select image first");return;}

  document.getElementById("progress").innerText="Processing...";

  const reader=new FileReader();
  reader.readAsDataURL(file);

  reader.onload=async()=>{
    const worker=await Tesseract.createWorker("kan+eng");
    const {data}=await worker.recognize(reader.result);
    const text=data.text.trim();
    document.getElementById("ocr").value=text;
    await worker.terminate();
    document.getElementById("progress").innerText="Done!";

    transliterate(text);
    translate(text);
  };
}

function transliterate(text){
  try{
    document.getElementById("lat").value=transliterate.transliterate(text);
  }catch(e){
    document.getElementById("lat").value="Transliteration failed.";
  }
}

async function translate(text){
  try{
    const res=await fetch("https://libretranslate.de/translate",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        q:text,
        source:"kn",
        target:"en",
        format:"text"
      })
    });
    const json=await res.json();
    document.getElementById("eng").value=json.translatedText;
  }catch(e){
    document.getElementById("eng").value="Translation failed.";
  }
}

function download(id,name){
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([
    document.getElementById(id).value
  ]));
  a.download=name;
  a.click();
}
</script>

</body>
</html>
